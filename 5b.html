<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Mvc-intro by severisv</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
	<link rel="stylesheet" href="lib/highlight/styles/atelier-heath.light.css">

  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">MVC-intro</h1>
      <h2 class="project-tagline">Introduksjon til ASP.NET MVC5</h2>
    </section>

    <section class="main-content">
 <a href="oppgave5.html#5b"><= Tilbake</a>
	<h3>Sende form med Ajax</h3>
	<quotes><p><strong>Hva er Ajax?</strong><br>
	Ajax, eller Asynkron JavaScript og XML, er en webutviklingsteknikk for å lage interaktive nettsider. Dette gjøres ved at sidene utveksler litt og litt data med serveren i bakgrunnen, i stedet for å laste hele siden på nytt hver gang brukeren gjør en forandring. Vi bruker ofter jQuery for å skrive Ajax-requests.
	</p></quotes>
	<p>Det første vi vil gjøre er å endre slik at skjemaet sendes inn med Ajax. Dette gjør vi i JavaScript som vi legger nederst i Index. Normalt vil vi legge det i en egen fil ettersom det er gunstig med tanke på caching, minification osv, men for denne oppgaven legger vi det bare nederst i <code>Index.cshtml</code>.</p>
	
	<pre><code class="html">&lt;script></code><code class="js">
	
	var form = $("form");

	form.submit(function (e) {
		// Hindre skjemaet i å sendes inn på vanlig måte
		e.preventDefault();

		// Samle input-dataen i en string
		var input = form.serialize();

		// Hent url fra action-attributten til skjemaet
		var url = form.attr('action');

		// Post skjemaet med ajax
		$.post(url, input, function (data) {
			// Sett inn resultatet i div'en med id 'person-info'
			$('#person-info').html(data);
		});

});</code><code class="html">
&lt;/script></code></pre>
<p>For at vi skal ha et sted å plassere innholdet må vi pakke inn hele <code>Index.cshtml</code> i en <i>div</i> med en passende id: <pre><code>&lt;div id="person-info">
    &lt;h2>Index</h2>
	.......
&lt;/div></code></pre>

</p>
	<p>I tillegg må vi flytte lastningen av jQuery øverst i <code>_Layout.cshtml</code> slik at det er tilgjengelig når html-en lastets. Legg den head under modernir:
<pre><code>&lt;head>
	&lt;meta charset="utf-8" />
	&lt;meta name="viewport" content="width=device-width, initial-scale=1.0">
	&lt;title>@ViewBag.Title - My ASP.NET Application&lt;/title>
	@Styles.Render("~/Content/css")
	@Scripts.Render("~/bundles/modernizr")
	<strong>@Scripts.Render("~/bundles/jquery")   </strong> 
&lt;/head></code></pre>
	
	
	
	<p>
		Vi refresher <i>Index</i> og sender inn skjemaet.<br>
		Det funker det, men vi får footeren to ganger. Hmmmm. Vi inspiserer person-info-diven og ser at vi har fått hele skjermbildet på nytt, inkludert menyen, stylesheets, JavaScript - alt som er i <i>_Layout.cshtml</i>.
		
	</p>
	<p>
		For å fikse dette må vi gjøre noen grep i <code>PersonController</code>:
		<pre>
		<code class="cs">
[HttpPost]
public ActionResult Create(PersonModel model)
{
	if (ModelState.IsValid)
	{
		if (Request.IsAjaxRequest())
		{
			return PartialView("Show", model);
		}
		return View("Show", model);
	}


	if (Request.IsAjaxRequest())
	{
		return PartialView("Index", model);
	}

	return View("Index", model);
}
	</code></pre>
	Vi bygger på nytt og ser at det funker.<br>
	Det fine nå er at vi ikke behøver å laste hele siden på nytt, så vi sparer trafikk og brukern får rask tilbakemelding. I tillegg har vi <i>fallback</i> hvis JavaScript ikke er på - da fungerer det som før.
	</p>
	
	
	<br>

 <a href="oppgave5.html#5b"><= Tilbake</a>

    </section>  
  </body>
  
  <script src="lib/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</html>

